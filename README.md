# Argyi
A tool for automatic C integer error fixing

Introduction
------------
Argyi is a tool for automatic C integer error fixing. An integer error in C program can be overflow/underflow error, unexpected signedness conversion, unexpected lossy truncation and undefined behaviors involving integer operation.
In general, they are covered by CWE190, 191, 194, 195, 196, 197 and 680. The correctness of integer operation is usually under-specified in practice. 
Therefore, we can effectively locate and fix integer errors by inference of possible values for program expressions. Based on this insight, we design a framework
Range Analysis Based Integer Error Fixing (RABIEF for short) framework to automate C integer error fixing.

Argyi is also the prototype tool for the paper "RABIEF: A Framework for Automatic C Integer Error Fixing"

Why it is called "Argyi"
------------------------
This name is inspired by the name of a plant *Artemisia argyi*, the Chinese mugwort, which is strongly aromatic and has medical effects.

Requirements
------------
OS: Linux distributions ([Ubuntu 14.04 LTS](http://www.ubuntu.com/download/desktop) is recommended)

[GCC](https://gcc.gnu.org/): the GNU Compiler Collection (our experiments are based on v5.2.1)

[CIL](https://www.cs.berkeley.edu/~necula/cil/): Infrastructure for C Program Analysis and Transformation (v1.3.7)

[Z3](https://github.com/Z3Prover/z3): Z3 Theorem Prover (v4.4.2)

[Eclipse](https://eclipse.org/mars/): Eclipse IDE (it is highly recommended to load our projects using Eclipse IDE)

Setup & Configuration
---------------------
To run Argyi, you should first configure the project.

1. Load `CPAchecker` and `CIntFix` projects into your workspace
2. Open `IntErrorFix.java` in package `org.tsinghua.cxcfan` of `CIntFix` project. Please specify a valid path name for `fileNameWithoutExt`, `cpacheckerLocation` and `tuDir`. 
  1. `fileNameWithoutExt` is the path that stores intermediate result of analysis, including Max-SMT type constraint, location information and recommended fixes
  2. `cpacheckerLocation` is the path of execution shell script of CPAchecker. Its path is typically `path/to/CPAchecker/scripts/cpa.sh`
  3. `tuDir` is the path containing files to be analyzed. Argyi only processes `*.cil.i` file, which is generated by CIL or cpp (C preprocessor)
3. Compile `libargyi` library for supporting sanity checks.
  1. Go to `path/to/CIntFix/src/org/tsinghua/cxcfan/libargyi` folder
  2. Compile `libargyi` library using the following command line:
  ```shell
  make
  make install
  ```
  If you do not need `libargyi`, you can uninstall it with the following command line:
  ```shell
  make uninstall
  ```

A Simple Instruction
--------------------
1. Preprocess your C project with CIL or gcc. Please ensure that the product of preprocessing should be a single `.cil.i` file. (If you are using cpp, you can rename the `.i` file to corresponding `.cil.i` manually)
2. Put the preprocessed file under the folder specified by `tuDir`. 
3. Run the project `IntErrorFix`, then the fixing procedure starts. Useful information such as performance profiling and list of fixed sites are output into console. You can collect these information from console.
4. For each `.cil.i` file, Argyi produces a `.cil.fixed.i` file which is the fixing result. You can compile this file directly by linking required libraries plus `-largyi` which provides supports for sanitizations.

Warning
-------
1. You can put multiple `.cil.i` files into `tuDir`, and Argyi will process them in a batch.
2. Files in `.cil.i` will be modified by Argyi. Please make backups for `.cil.i` files.
3. If the `.cil.i` is not generated directly by CIL, you may be unable to compile it directly. In this case, you should replace the fixed functions along with declaration of sanity check functions into the original program file. To compile the fixed program, you still need to link the library `libargyi`.

Additional Note
---------------
A detailed instruction manual will be uploaded soon!
